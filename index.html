<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Login Request Form</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
    body { 
      display: flex; 
      height: 100vh; 
      background: url('quezelco1.png') no-repeat center center fixed; /* Added background image */
      background-size: cover; /* Cover the entire viewport */
      color: white; 
      flex-direction: column; 
      align-items: center; 
      justify-content: center; 
    } /* Centered vertically */

    .sidebar {
      width: 260px;
      background: rgba(0, 0, 0, 0.7);
      padding: 20px;
      backdrop-filter: blur(10px);
      transition: 0.3s;
      display: none;
    }
    .sidebar h2 { margin-bottom: 15px; text-align: center; color: #00adb5; }
    .sidebar ul { list-style: none; }
    .sidebar li {
      padding: 12px;
      cursor: pointer;
      transition: 0.3s;
      border-radius: 8px;
      text-align: center;
    }
    .sidebar li:hover {
      background: #00adb5;
      color: white;
      transform: scale(1.05);
    }

    .container {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      width: 100%; /* Ensure container takes full width */
      box-sizing: border-box; /* Include padding in element width */
    }

    #officeSelection, #loginForm, #requestFormSection, #adminHistorySection {
      background: rgba(230, 224, 224, 0.1);
      padding: 25px;
      border-radius: 12px;
      backdrop-filter: blur(12px);
      box-shadow: 0 8px 16px rgba(0,0,0,0.2);
      text-align: center;
      width: 320px;
      margin-bottom: 20px;
    }

    input, button, select, textarea {
      width: 100%;
      padding: 12px;
      margin-top: 10px;
      border: none;
      border-radius: 8px;
      outline: none;
      font-size: 16px;
      background: rgba(225, 220, 220, 0.934);
      color: black;
    }

    button {
      background: #00adb5;
      cursor: pointer;
      transition: 0.3s;
      color: white;
    }

    button:hover {
      background: #008891;
      transform: scale(1.05);
    }

    .form-container {
      display: none;
      background: rgba(255, 255, 255, 0.1);
      padding: 20px;
      border-radius: 12px;
      width: 400px;
      backdrop-filter: blur(12px);
      box-shadow: 0 8px 16px rgba(0,0,0,0.2);
    }

    #guardRequests, #managerSection, #adminHistorySection {
      margin-top: 20px;
      text-align: left;
      background: rgba(255, 255, 255, 0.1);
      padding: 25px;
      border-radius: 12px;
      width: 1000px;
      backdrop-filter: blur(12px);
      box-shadow: 0 8px 16px rgba(0,0,0,0.2);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    table, th, td {
      border: 1px solid #00adb5;
    }

    th, td {
      padding: 10px;
      text-align: left;
    }

    th {
      background-color: #00adb5;
    }

    .action-btns button {
      margin-right: 5px;
      padding: 5px 10px;
    }

    .office-title {
      margin-bottom: 10px;
      font-size: 24px;
      font-weight: bold;
    }

    .office-title.MainOffice {
      color: #007bff;
    }

    .office-title.Gumaca {
      color: #28a745;
    }
    .office-title.Atimonan {
      color: #dc3545;
    }
    .office-title.Lopez {
      color: #ffc107;
    }
    .office-title.Calauag {
      color: #17a2b8;
    }
    .office-title.Guinyangan {
      color: #6c757d;
    }
    .office-title.Tagkawayan {
      color: #0062cc;
    }
    .office-title.DelGallego {
      color: #990099;
    }
    .office-title.Macalelon {
      color: #008000;
    }
    .office-title.GeneralLuna {
      color: #FFA500;
    }
    .office-title.Catanuan {
      color: #800080;
    }
    .office-title.Mulanay {
      color: #808000;
    }
    .office-title.SanFrancisco {
      color: #00FFFF;
    }
    .office-title.SanAndres {
      color: #A0522D;
    }
    .office-title.SanNarciso {
      color: #FF00FF;
    }
    .office-title.Buenavista {
      color: #D2691E;
    }
    .return-btn button {
      background-color: red; /* Red background for return buttons */
      color: white;
    }
    header {
      display: flex;
      align-items: center; /* Vertically align items */
      margin-bottom: 20px;
    }

    header img {
      max-width: 100px; /* Adjust as needed */
      max-height: 100px; /* Adjust as needed */
      margin-right: 20px; /* Add space between logo and text */
    }

    header h1 {
      margin: 0; /* Remove default margin */
    }
  </style>
</head>
<body>
  <header>
    <img src="qz1.png" alt="Quezelco 1 Logo">
    <h1>Quezon 1 Electric Cooperative Inc.</h1>
  </header>
  <div class="container" id="officeSelection">
    <h2>Select Your Office</h2>
    <select id="officeDropdown">
      <option value="" disabled selected>Select Office</option>
      <option>Main Office</option>
      <option>Gumaca</option>
      <option>Atimonan</option>
      <option>Lopez</option>
      <option>Calauag</option>
      <option>Guinyangan</option>
      <option>Tagkawayan</option>
      <option>Del Gallego</option>
      <option>Macalelon</option>
      <option>General Luna</option>
      <option>Catanuan</option>
      <option>Mulanay</option>
      <option>San Francisco</option>
      <option>San Andres</option>
      <option>San Narciso</option>
      <option>Buenavista</option>
    </select>
    <button onclick="proceedToLogin()">Proceed</button>
    <button onclick="showAdminHistory()">Admin History</button>
  </div>

  <!-- Sidebar -->
  <div class="sidebar" id="roleSidebar">
    <h2>Select Role</h2>
    <ul>
      <li onclick="showLogin('employee')">Employee</li>
      <li onclick="showLogin('manager')">Manager</li>
      <li onclick="showLogin('guard')">Guard</li>
    </ul>
  </div>

  <div class="container">
    <div id="loginForm" style="display: none;">
      <h2>Login</h2>
      <input type="text" id="username" placeholder="Username" required />
      <input type="password" id="password" placeholder="Password" required />
      <button onclick="checkLogin()">Login</button>
      <div class="return-btn"><button onclick="returnToOfficeSelection()">Return</button></div>
    </div>

    <div id="requestFormSection" class="form-container">
      <h2 id="officeTitle"></h2>
      <h2>Request Form</h2>
      <input type="text" id="name" placeholder="Name" required />
      <select id="department">
        <option>Finance</option><option>IT</option><option>Corporate Planning</option><option>Admin</option>
        <option>Member Services</option><option>Audit</option><option>Engineering</option><option>Operations</option>
      </select>
      <textarea id="purpose" rows="2" placeholder="Purpose"></textarea>
      <input type="text" id="destination" placeholder="Destination" required />
      <input type="text" id="serviceVehicle" placeholder="Service Vehicle" required />
      <input type="text" id="companions" placeholder="Name of Employees (Companions)" required />
      <button onclick="submitRequest()">Submit</button>
      <p id="submissionStatus" style="color: #00adb5;"></p>
      <div class="return-btn"><button onclick="returnToPrevious()">Return</button></div>
    </div>

    <div id="managerSection" style="display: none;">
      <h2 id="officeTitle"></h2>
      <h2>Requests for Manager Approval</h2>
      <table>
        <thead>
          <tr>
            <th>Name</th><th>Department</th><th>Purpose</th><th>Destination</th><th>Service Vehicle</th><th>Companions</th><th>Actions</th>
          </tr>
        </thead>
        <tbody id="managerList"></tbody>
      </table>
      <div class="return-btn"><button onclick="returnToPrevious()">Return</button></div>
    </div>

    <div id="guardRequests" style="display: none;">
      <h2 id="officeTitle"></h2>
      <h2>Approved and Rejected Requests</h2>
      <table>
        <thead><tr><th>Name</th><th>Department</th><th>Purpose</th><th>Destination</th><th>Service Vehicle</th><th>Companions</th><th>Time</th><th>Status</th><th>Departure</th><th>Arrival</th></tr></thead>
        <tbody id="approvedList"></tbody>
      </table>
      <table>
        <thead><tr><th>Name</th><th>Department</th><th>Purpose</th><th>Destination</th><th>Service Vehicle</th><th>Companions</th><th>Time</th><th>Status</th><th>Departure</th><th>Arrival</th></tr></thead>
        <tbody id="rejectedList"></tbody>
      </table>
      <div class="return-btn"><button onclick="returnToPrevious()">Return</button></div>
    </div>

    <div id="adminHistorySection" style="display: none;">
      <h2>Admin History</h2>
      <select id="adminOfficeSelect">
        <option value="" disabled selected>Select Office</option>
        <option>Main Office</option>
        <option>Gumaca</option>
        <option>Atimonan</option>
        <option>Lopez</option>
        <option>Calauag</option>
        <option>Guinyangan</option>
        <option>Tagkawayan</option>
        <option>Del Gallego</option>
        <option>Macalelon</option>
        <option>General Luna</option>
        <option>Catanuan</option>
        <option>Mulanay</option>
        <option>San Francisco</option>
        <option>San Andres</option>
        <option>San Narciso</option>
        <option>Buenavista</option>
      </select>
      <button onclick="displayAdminHistory()">Show History</button>
      <div id="adminHistoryTable"></div>
      <div class="return-btn"><button onclick="returnToPrevious()">Return</button></div>
    </div>
  </div>

  <script>
    let pendingRequests = [];
    let approvedRequests = [];
    let rejectedRequests = [];
    let currentManager = "";
    let selectedOffice = "";
    let previousSection = ""; 

    const managerAccounts = {
      Finance: { username: "fin", password: "1" },
      IT: { username: "it", password: "1" },
      "Corporate Planning": { username: "cp", password: "1" },
      Admin: { username: "admin", password: "1" },
      "Member Services": { username: "ms", password: "1" },
      Audit: { username: "audit", password: "1" },
      Engineering: { username: "eng", password: "1" },
      Operations: { username: "ops", password: "1" }
    };

    //Improved helper function to clear forms completely
    function clearForm(formId) {
      const form = document.getElementById(formId);
      if (form) {
        form.querySelectorAll('input[type="text"], input[type="password"], textarea, select').forEach(element => {
          element.value = ''; 
        });
        //reset selected index for select elements
        form.querySelectorAll('select').forEach(select => select.selectedIndex = 0);
      }
    }

    function proceedToLogin() {
      selectedOffice = document.getElementById("officeDropdown").value;
      if (!selectedOffice) {
        alert("Please select an office.");
        return;
      }
      hideAllSections();
      document.getElementById("roleSidebar").style.display = "block";
      previousSection = "officeSelection"; 
    }

    function showLogin(role) {
      hideAllSections();
      document.getElementById("loginForm").style.display = "block";
      clearForm("loginForm"); 
      previousSection = "roleSidebar"; 
    }

    function hideAllSections() {
      const sections = ["officeSelection", "loginForm", "requestFormSection", "managerSection", "guardRequests", "adminHistorySection", "roleSidebar"];
      sections.forEach(id => document.getElementById(id).style.display = "none");
    }

    function checkLogin() {
      const user = document.getElementById("username").value;
      const pass = document.getElementById("password").value;

      if (user === "emp" && pass === "1") {
        hideAllSections();
        document.getElementById("requestFormSection").style.display = "block";
        setOfficeTitle();
        previousSection = "loginForm"; 
      } else if (user === "g" && pass === "1") {
        hideAllSections();
        document.getElementById("guardRequests").style.display = "block";
        displayGuardRequests();
        previousSection = "loginForm"; 
      } else {
        for (const dept in managerAccounts) {
          if (user === managerAccounts[dept].username && pass === managerAccounts[dept].password) {
            currentManager = dept;
            hideAllSections();
            document.getElementById("managerSection").style.display = "block";
            displayManagerRequests();
            previousSection = "loginForm"; 
            return;
          }
        }
        alert("Invalid credentials.");
      }
      clearForm("loginForm"); 
    }

    function setOfficeTitle() {
      const officeTitleElement = document.getElementById("officeTitle");
      officeTitleElement.textContent = selectedOffice;
      officeTitleElement.className = "office-title " + selectedOffice.replace(/\s+/g, '');
    }

    function submitRequest() {
      const name = document.getElementById("name").value;
      const dept = document.getElementById("department").value;
      const purpose = document.getElementById("purpose").value;
      const dest = document.getElementById("destination").value;
      const vehicle = document.getElementById("serviceVehicle").value;
      const companions = document.getElementById("companions").value;

      if (!name || !dept || !purpose || !dest || !vehicle || !companions) {
        alert("Please fill in all fields.");
        return;
      }

      const request = {
        name, dept, purpose, dest, vehicle, companions, time: new Date().toLocaleString(), office: selectedOffice, departure: null, arrival: null
      };

      pendingRequests.push(request);
      document.getElementById("submissionStatus").innerText = "Request submitted for manager approval.";
      clearForm("requestFormSection"); 
    }

    function displayManagerRequests() {
      const tbody = document.getElementById("managerList");
      tbody.innerHTML = "";
      pendingRequests
        .filter(req => req.dept === currentManager)
        .forEach((req, index) => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${req.name}</td><td>${req.dept}</td><td>${req.purpose}</td>
            <td>${req.dest}</td><td>${req.vehicle}</td><td>${req.companions}</td>
            <td class="action-btns">
              <button onclick="approveRequest(${index})">Approve</button>
              <button onclick="rejectRequest(${index})">Reject</button>
            </td>`;
          tbody.appendChild(row);
        });
    }

    function approveRequest(index) {
      const req = pendingRequests.splice(index, 1)[0];
      req.status = "Approved";
      approvedRequests.push(req);
      document.getElementById("submissionStatus").innerText = ""; // Clear the submission message
      displayManagerRequests();
      displayGuardRequests();
    }

    function rejectRequest(index) {
      const req = pendingRequests.splice(index, 1)[0];
      req.status = "Rejected";
      rejectedRequests.push(req);
      document.getElementById("submissionStatus").innerText = ""; // Clear the submission message
      displayManagerRequests();
      displayGuardRequests();
    }

    function updateDepartureTime(button) {
      const row = button.parentNode.parentNode; 
      const departureCell = row.querySelector('td:nth-child(9)');
      const newDepartureTime = new Date().toLocaleString();
      departureCell.textContent = newDepartureTime;
      const requestIndex = approvedRequests.findIndex(req => req.name === row.querySelector('td:nth-child(1)').textContent);
      if (requestIndex > -1) {
          approvedRequests[requestIndex].departure = newDepartureTime;
      }
    }

    function updateArrivalTime(button) {
      const row = button.parentNode.parentNode; 
      const arrivalCell = row.querySelector('td:nth-child(10)');
      const newArrivalTime = new Date().toLocaleString();
      arrivalCell.textContent = newArrivalTime;
      const requestIndex = approvedRequests.findIndex(req => req.name === row.querySelector('td:nth-child(1)').textContent);
      if (requestIndex > -1) {
          approvedRequests[requestIndex].arrival = newArrivalTime;
      }
    }

    function displayGuardRequests() {
      const aList = document.getElementById("approvedList");
      const rList = document.getElementById("rejectedList");
      aList.innerHTML = "";
      rList.innerHTML = "";

      approvedRequests.forEach(req => {
        const row = aList.insertRow();
        createTableRow(row, req);
      });

      rejectedRequests.forEach(req => {
        const row = rList.insertRow();
        createTableRow(row, req);
      });
    }

    function createTableRow(row, req) {
        let departureTime = req.departure || `<button onclick="updateDepartureTime(this)">Update Departure</button>`;
        let arrivalTime = req.arrival || `<button onclick="updateArrivalTime(this)">Update Arrival</button>`;

        [req.name, req.dept, req.purpose, req.dest, req.vehicle, req.companions, req.time, req.status, departureTime, arrivalTime].forEach(cellData => {
            const cell = row.insertCell();
            cell.innerHTML = cellData; 
        });
    }

    function showAdminHistory() {
      hideAllSections();
      document.getElementById("adminHistorySection").style.display = "block";
      document.getElementById("adminOfficeSelect").selectedIndex = 0;
      previousSection = "officeSelection"; 
    }

    function displayAdminHistory() {
      const selectedOffice = document.getElementById("adminOfficeSelect").value;
      const historyTable = document.getElementById("adminHistoryTable");
      historyTable.innerHTML = "";

      const allRequests = [...approvedRequests, ...rejectedRequests];
      const filteredRequests = allRequests.filter(req => req.office === selectedOffice);

      if (filteredRequests.length === 0) {
        historyTable.innerHTML = "<p>No requests found for this office.</p>";
        return;
      }

      const table = document.createElement("table");
      const headerRow = table.insertRow();
      ["Name", "Department", "Purpose", "Destination", "Service Vehicle", "Companions", "Time", "Status", "Departure", "Arrival"].forEach(header => {
        const th = document.createElement("th");
        th.textContent = header;
        headerRow.appendChild(th);
      });

      filteredRequests.forEach(req => {
        const row = table.insertRow();
        let departureTime = req.departure || "";
        let arrivalTime = req.arrival || "";
        [req.name, req.dept, req.purpose, req.dest, req.vehicle, req.companions, req.time, req.status, departureTime, arrivalTime].forEach(cellData => {
            const cell = row.insertCell();
            cell.textContent = cellData;
        });
      });
      historyTable.appendChild(table);
    }

    function returnToOfficeSelection() {
        hideAllSections();
        document.getElementById("officeSelection").style.display = "block";
        document.getElementById("officeDropdown").selectedIndex = 0;
        previousSection = "officeSelection";
    }

    function returnToPrevious() {
      hideAllSections();
      document.getElementById(previousSection).style.display = "block";
      if (previousSection === "loginForm") {
        clearForm("loginForm");
      } else if (previousSection === "requestFormSection") {
        clearForm("requestFormSection");
      } else if (previousSection === "officeSelection") {
        clearForm("officeSelection"); 
      }
    }
  </script>
</body>
</html>